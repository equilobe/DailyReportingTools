<div style="margin-top:15px; font-size:12px; color:#000000;">

    <h3 style="color:black">@Model.Title</h3>

    @{
        var bold = "";
        var remainingEstimate = "";
        var colorTotal = "black";
        var color = "black";
        var tasks = "";
        var comma = "";
        var openParentheses = "(";
        var closedParentheses = ")";
        var indentation = "";
        var totalTimeSpent = "";
        var revision = "";
        var tooltipWorked = "";
        var tooltipCommit = "";
    }

    <div>
        @Partial("Views/summary.cshtml", Model.Summary)
    </div>

    <div style="margin-top:40px; line-height:1.4em;">
        @if (Model.Authors.Count > 0)
        {
            foreach (var author in Model.Authors)
            {
                @if (author.HasDayLogs || author.HasAssignedIssues)
                {
                    <div style="margin-top:40px;">
                        <h1 style="color:black; line-height:1.4em; margin-bottom:0px">@author.Name</h1>

                        @if (author.DayLogs.Count > 0)
                        {
                            foreach (var dayLog in author.DayLogs)
                            {
                                <div style="margin-top:15px; line-height:1.4em">
                                    @Partial("Views/workedHeader.cshtml", dayLog)
                                    @if (dayLog.Issues != null)
                                    {
                                        if (dayLog.Issues.Count > 0)
                                        {
                                            <table style="margin-left:10px; margin-top:5px" cellpadding="1.5px">
                                                <tbody>
                                                    @foreach (var issue in dayLog.Issues)
                                                    {
                                                        if (issue.AssigneeSubtasks != null)
                                                        {
                                                            if (issue.AssigneeSubtasks.Count > 0)
                                                            {
                                                                if (issue.ExistsInTimesheet == true && issue.LoggedAuthor == author.Name)
                                                                {
                                                                    @Partial("Views/workedTask.cshtml", issue)
                                                                }
                                                                else
                                                                {
                                                                    @Partial("Views/parentTask.cshtml", issue)
                                                                }
                                                                foreach (var subtask in issue.AssigneeSubtasks)
                                                                {
                                                                    @Partial("Views/workedTask.cshtml", subtask)
                                                                }
                                                            }
                                                        }
                                                        if (issue.AssigneeSubtasks == null || issue.AssigneeSubtasks.Count == 0)
                                                        {
                                                            if (issue.IsSubtask == false)
                                                            {
                                                                @Partial("Views/workedTask.cshtml", issue)
                                                            }
                                                        }
                                                    }
                                                </tbody>
                                            </table>
                                        }
                                    }
                                </div>

                                if (dayLog.UnsyncedCommits.Count > 0)
                                {
                                    @Partial("Views/unrelatedCommits.cshtml", dayLog.UnsyncedCommits)
                                }
                            }
                        }
                        @if (Model.HasSprint)
                        {
                            @if (author.InProgressTasks.Count > 0)
                            {
                                <div style="margin-top:20px; line-height:1.4em;">
                                    <b style="color:sienna; font-size:16px;">In Progress</b>

                                    @if (author.Timing.InProgressTasksTimeLeftSeconds == 0)
                                    {
                                        <span style="color:red; font-size:12px;"> &#x25cf; @author.Timing.InProgressTasksTimeLeftString left</span>
                                    }
                                    else
                                    {
                                        <span style="color:sienna; font-size:12px;"> &#x25cf; @author.Timing.InProgressTasksTimeLeftString left</span>
                                    }
                                    <table style="margin-left:10px; margin-top:5px" cellpadding="1.5px">
                                        <tbody>
                                            @foreach (var task in author.InProgressTasksParents)
                                            {
                                                if (task.Assignee == author.Name)
                                                {
                                                    @Partial("Views/uncompletedTask.cshtml", task)
                                                    if (task.SubtasksIssues != null)
                                                    {
                                                        if (task.SubtasksIssues.Count > 0)
                                                        {
                                                            foreach (var subtask in task.SubtasksIssues)
                                                            {
                                                                @Partial("Views/subtasks.cshtml", subtask)
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    @Partial("Views/parentTask.cshtml", task)
                                                    foreach (var subtask in task.AssigneeSubtasks)
                                                    {
                                                        @Partial("Views/subtasks.cshtml", subtask)
                                                    }
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }

                            @if (author.OpenTasks.Count > 0)
                            {
                                <div style="line-height:1.4em; color:sienna; margin-top:20px;">
                                    <b style="font-size: 16px; color: sienna">Upcoming </b>
                                    @if (author.Timing.OpenTasksTimeLeftSeconds != 0)
                                    {
                                        <span style="color: sienna; font-size:12px;"> &#x25cf; @author.Timing.OpenTasksTimeLeftString left</span>
                                    }
                                    else
                                    {
                                        <span style="color:red; font-size:12px;">&#x25cf; @author.Timing.OpenTasksTimeLeftString left</span>
                                    }
                                    <table style="margin-left:10px; margin-top:5px" cellpadding="1.5px">
                                        <tbody>
                                            @foreach (var task in author.OpenTasksParents)
                                            {
                                                if (task.Assignee == author.Name)
                                                {
                                                    @Partial("Views/uncompletedTask.cshtml", task)
                                                    if (task.SubtasksIssues != null)
                                                    {
                                                        if (task.SubtasksIssues.Count > 0)
                                                        {
                                                            foreach (var subtask in task.SubtasksIssues)
                                                            {
                                                                @Partial("Views/subtasks.cshtml", subtask)
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    @Partial("Views/parentTask.cshtml", task)
                                                    foreach (var subtask in task.AssigneeSubtasks)
                                                    {
                                                        @Partial("Views/subtasks.cshtml", subtask)
                                                    }
                                                }
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            }
                        }
                    </div>
                }

            }
        }
    </div>

    @if (Model.HasSprint && Model.Summary.UnassignedTasksCount > 0)
    {
        <div style="margin-top:60px; line-height:1.4em;">
            <h1 style="color:black">Unassigned </h1>
            <table style="margin-left:10px; margin-top:5px" cellpadding="1.5px">
                <tbody>
                    @foreach (var task in Model.ReportTasks.UnassignedTasks)
                    {
                        if (task.IsSubtask == false)
                        {
                            @Partial("Views/uncompletedTask.cshtml", task)
                        }
                    }
                </tbody>
            </table>
        </div>
    }

    @Partial("Views/completedTasks.cshtml", Model.ReportTasks)

    @if (Model.IsFinalDraft)
    {
            <table style="margin-top:50px; width:250px; height:50px;">
                <tbody>
                    <tr>
                        <td width="100px" height="40px" title="This will confirm the draft for ALL users and send the final report &#013; Only click the button after: &#013; - errors have been corrected &#013; - everyone has logged their work &#013; - sprint scope has been adjusted (if necessary)" style="display:inline-block; padding:0px; line-height:40px;">
                            @Partial("Views/confirmationButton.cshtml", Model.SendReportUrl)
                        </td>
                        <td width="30px" height="40px" style="display:inline-block;font-size:12px; line-height:40px;padding:0px; text-align:center">
                            or
                        </td>
                        <td width="100px" height="40px;" style="display:inline-block; padding:0px; line-height:40px;">
                            <a style="color:#0000FF; font-weight:bold; text-decoration:none; font-size:12px; line-height:40px" href="@Model.SendDraftUrl" title="If the information in the report has changed and you want to see how it looks now, before confirming it, you can get a new one.">Resend</a>
                        </td>
                    </tr>
                </tbody>
            </table>
    }

</div>