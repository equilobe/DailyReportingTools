<div style="margin-top:15px">
      @if(Model.options.FromDate==Model.options.ToDate)
        {
           <h2> @Model.Title Daily Report for @Model.Date.ToString("dddd, dd MMMM yyyy") </h2>
        }
        else
        {
           <h2>@Model.Title Daily Report for @Model.options.FromDate.ToString("dddd, dd MMMM yyyy") - @Model.options.ToDate.ToString("dddd, dd MMMM yyyy")</h2>
        }  
    @{
        var bold = "";
        var remainingEstimate = "";
        var color="black";
    }
  
    <div style="margin-top: 40px">
        <div>
            <h2>Timesheet</h2>

            @if (Model.Authors.Count == 0)
            {
                <span  style="margin-top:20px"><b>No work logged</b></span>
            }
            else
            {
                <b> @Model.TotalTime worked</b>
                <div style="margin-top:10px">
                    @foreach (var summary in Model.Summary)
                    {
                        <div>@summary.TimeLogged - @summary.Name</div>
                    }
                </div>
                foreach (var author in Model.Authors)
                {
                    <div style="margin-top:25px">
                        <b>@author.Name - @author.TimeLogged</b>

                        @foreach (var issue in author.Issues)
                        {
                            if (issue.Subtasks.Count > 0)
                            {
                                remainingEstimate = issue.TotalRemaining;
                            }
                            else
                            {
                                remainingEstimate = issue.RemainingEstimate;
                            }
                            <div>
                                <span>@issue.TimeLogged</span>
                                @if (issue.Label != Model.policy.PermanentTaskLabel)
                                {
                                    if (issue.Resolution != null)
                                    {
                                        <span>(@issue.Resolution)</span>
                                    }

                                    else if (issue.RemainingEstimate != null)
                                    {
                                        if (issue.RemainingEstimateSeconds == 0)
                                        {
                                            <span>(<b style="color:red">@remainingEstimate left</b>)</span>
                                        }
                                        else
                                        {
                                            <span> (@remainingEstimate left) </span>
                                        }
                                    }
                                }
                                @if (issue.SubTask == true)
                                {
                                    <span> - <a href=@issue.Parent.Link style="text-decoration: none"> @issue.Parent.Summary </a><span style="color: #B8B8B8;"> &#x25cf; @issue.Parent.Key </span>  &#x25cf; <a href=@issue.Link style="text-decoration: none"> @issue.Summary</a> <span style="color: #B8B8B8"> &#x25cf; @issue.Key </span></span>
                                }
                                else
                                {
                                    <span> - <a href=@issue.Link style="text-decoration: none"> @issue.Summary</a> <span style="color: #B8B8B8"> &#x25cf; @issue.Key </span></span>
                                }
                                @if (issue.Label != Model.policy.PermanentTaskLabel)
                                {
                                    if (issue.Assignee == null)
                                    {
                                        <span> &#x25cf; Unassigned</span>
                                    }
                                    else if (issue.Assignee != author.Name)
                                    {
                                        <span style="white-space:nowrap"> &#x25cf; @issue.Assignee)</span>
                                    }
                                }
                                @foreach (var entry in issue.Entries)
                                {
                                    <div>
                                        @if (entry.Comment != "")
                                        {
                                            <div>
                                                @foreach (string comment in entry.Comment.Split('\n'))
                                                {
                                                    <div style="margin-left:35px"> @comment</div>
                                                }
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            }
            </div>
        </div>


    <div style="margin-top:30px">
        <h2>Sprint status</h2>

        <div style="margin-top:10px;">
            <i style="color: #B8B8B8;">Tasks in bold have work logged in the timesheet.</i>
        </div>
            
        @if (Model.SprintReport.CompletedTasksList!=null)
        {
            foreach(var completedTasks in Model.SprintReport.CompletedTasksList)
            {   
                if(DateTime.Compare(completedTasks.Tasks.First().ResolutionDate, Model.options.FromDate)>=0)
                {
                   <div style="margin-top:20px">
                    <h4>Completed @completedTasks.CompletedTimeAgo (@completedTasks.Tasks.Count)</h4>
                    @foreach (var task in completedTasks.Tasks)
                    {

                        if (task.Issue.ExistsInTimesheet == true)
                        {
                            bold = "font-weight: bold;";
                        }
                        else
                        {
                            bold = "font-weight: normal;";
                        }
                        <div>
                            <span style="font-family: Segoe UI Symbol; font-size:10.5pt">&#10004;</span>
                            <a style="text-decoration: none; @bold;" href="@task.Issue.Link">@task.Issue.Summary</a>
                            <span style="color: #B8B8B8"> &#x25cf; @task.Issue.Key </span>
                            @if (task.Issue.Assignee != null)
                            {
                            <span style="white-space:nowrap"> &#x25cf; @task.Issue.Assignee </span>
                            }
                            @if (task.Issue.RemainingEstimateSeconds != 0)
                            {
                                <span style="white-space:nowrap"> &#x25cf; @task.Issue.RemainingEstimate </span>
                            }                       
                        </div>
                    }
               </div>               
                }
                               
            }
        }
            @if (Model.SprintReport.InProgressTasks != null)
            {
                <div style="margin-top:20px">
                    <h4>In progress (@Model.SprintReport.InProgressTasksCount)</h4>
                    @foreach (var task in Model.SprintReport.InProgressTasks)
                    {
                        if (task.Issue.Label != Model.policy.PermanentTaskLabel && task.Issue.SubTask == false)
                        {
                            if (task.Issue.ExistsInTimesheet == true)
                            {
                                bold = "font-weight: bold;";
                            }
                            else
                            {
                                bold = "font-weight: normal;";
                            }

                            if (task.Issue.Subtasks.Count > 0)
                            {
                                remainingEstimate = task.Issue.TotalRemaining;
                            }
                            else
                            {
                                remainingEstimate = task.Issue.RemainingEstimate;
                            }
                            if (task.Issue.RemainingEstimateSeconds == 0)
                            {
                                color = "red";
                            }
                            else
                            {
                                color = "black";
                            }
                            <div>
                                <span style="font-family: Wolfram Alpha; font-size:10.5pt">&#9658;</span>
                                <a style="text-decoration: none; @bold;" href="@task.Issue.Link">@task.Issue.Summary</a>
                                <span style ="color: #B8B8B8"> &#x25cf; @task.Issue.Key </span>
                                @if (task.Issue.Assignee != null)
                                {
                                    <span style="white-space:nowrap;"> &#x25cf; @task.Issue.Assignee</span>
                                }
                                @if (task.Issue.TimeSpent > 0)
                                {
                                    <span> &#x25cf; @task.Issue.TimeLogged worked </span>
                                    <span style="color:@color"> &#x25cf; @remainingEstimate left </span>
                                }                                   
                            </div>
                            if (task.Issue.SubtasksIssues != null)
                            {
                                if (task.Issue.SubtasksIssues.Count > 0)
                                {
                                    foreach (var subtask in task.Issue.SubtasksIssues)
                                    {
                                        if (subtask.ExistsInTimesheet == true)
                                        {
                                            bold = "font-weight: bold;";
                                        }
                                        else
                                        {
                                            bold = "font-weight: normal;";
                                        }
                                        if (subtask.RemainingEstimateSeconds == 0)
                                        {
                                            color = "red";
                                        }
                                        else
                                        {
                                            color = "black";
                                        }                                 
                                        <div style="margin-left:20px;">
                                            <span style="font-family: Segoe UI Symbol">
                                                @if (subtask.Resolution != null)
                                                {
                                                    <span style="font-size:10.5pt;">&#10004;</span>
                                                }
                                                else if(subtask.StatusCategory.name == "In Progress")
                                                {
                                                    <span style="font-size: 10.5pt; font-family: Wolfram Alpha;">&#9658;</span>
                                                }
                                                else
                                                { 
                                                    <span style="font-size:10.5pt;">&#10065;</span>
                                                    if(subtask.Status == Model.policy.ReopenedStatus)
                                                    {
                                                         <span style="font-weight:bold">Reopened</span>
                                                    }                                                         
                                                    else if(subtask.TimeSpent>0)
                                                    {
                                                        <span style="font-weight:bold">Paused</span>
                                                    }                                                       
                                                }
                                            </span>
                                            <a style="text-decoration: none; @bold;" href="@subtask.Link">@subtask.Summary</a>
                                            <span style="color: #B8B8B8;"> &#x25cf; @subtask.Key </span>
                                            @if (subtask.Assignee != null)
                                            {
                                                <span style="font-size:13px;white-space:nowrap;"> &#x25cf; @subtask.Assignee</span>
                                            }
                                            @if (subtask.TimeSpent > 0)
                                            {
                                                <span> &#x25cf; @subtask.TimeLogged worked </span>
                                                if (subtask.Resolution == null)
                                                {
                                                    <span style="color:@color;"> &#x25cf; @subtask.RemainingEstimate left </span>
                                                }
                                            }
                                        </div>

                                    }
                                }
                            }

                        }
                    }
                </div>
            }

            @if (Model.SprintReport.OpenTasks != null)
            {
                <div style="margin-top:20px;">
                    <h4>Upcoming (@Model.SprintReport.OpenTasksCount)</h4>
                    @foreach (var task in Model.SprintReport.OpenTasks)
                    {
                        if (task.Issue.Label != Model.policy.PermanentTaskLabel && task.Issue.SubTask == false)
                        {
                            if (task.Issue.ExistsInTimesheet == true)
                            {
                                bold = "font-weight: bold;";
                            }
                            else
                            {
                                bold = "font-weight: normal;";
                            }

                            if (task.Issue.Subtasks.Count > 0)
                            {
                                remainingEstimate = task.Issue.TotalRemaining;
                            }
                            else
                            {
                                remainingEstimate = task.Issue.RemainingEstimate;
                            }
                            if (task.Issue.RemainingEstimateSeconds == 0)
                            {
                                color = "red";
                            }
                            else
                            {
                                color = "black";
                            }
                            <div>
                                <span style="font-family: Segoe UI Symbol; font-size: 10.5pt">&#10065;</span>
                                @if (task.Issue.Status == Model.policy.ReopenedStatus)
                                {
                                        <b>Reopened: </b>
                                }
                                else
                                {
                                    if (task.Issue.TimeSpent > 0)
                                    {
                                           <b>Paused: </b>
                                    }
                                }
                                <a style="text-decoration: none; @bold;" href="@task.Issue.Link">@task.Issue.Summary</a>
                                <span style="color: #B8B8B8;"> &#x25cf; @task.Issue.Key </span>
                                @if (task.Issue.Assignee != null)
                                {
                                 <span style="white-space:nowrap;"> &#x25cf; @task.Issue.Assignee</span>
                                }

                                @if (task.Issue.TimeSpent > 0)
                                {
                                    <span> &#x25cf; @task.Issue.TimeLogged worked </span>
                                    <span style="color:@color"> &#x25cf; @remainingEstimate left </span>
                                }                                                            
                            </div>
                            if (task.Issue.SubtasksIssues != null)
                            {
                                if (task.Issue.SubtasksIssues.Count > 0)
                                {
                                    foreach (var subtask in task.Issue.SubtasksIssues)
                                    {
                                        if (subtask.ExistsInTimesheet == true)
                                        {
                                            bold = "font-weight: bold;";
                                        }
                                        else
                                        {
                                            bold = "font-weight: normal;";
                                        }
                                        if (subtask.RemainingEstimateSeconds == 0)
                                        {
                                            color = "red";
                                        }
                                        else
                                        {
                                            color = "black";
                                        }
                                        <div style="margin-left:20px;">
                                            <span style="font-family: Segoe UI Symbol">
                                               @if (subtask.Resolution != null)
                                               {
                                                   <span style="font-size:10.5pt;">&#10004;</span>
                                               }
                                               else if (subtask.StatusCategory.name == "In Progress")
                                               {
                                                   <span style="font-size: 10.5pt; font-family: Wolfram Alpha;">&#9658;</span>
                                               }
                                               else
                                               {
                                                   <span style="font-size:10.5pt;">&#10065;</span>
                                                   if (subtask.Status == Model.policy.ReopenedStatus)
                                                   {
                                                       <span style="font-weight:bold">Reopened</span>
                                                   }
                                                   else if (subtask.TimeSpent > 0)
                                                   {
                                                       <span style="font-weight:bold">Paused</span>
                                                   }
                                               }
                                            </span>
                                            <a style="text-decoration: none" href="@subtask.Link">@subtask.Summary</a>
                                            <span style="color: #B8B8B8;"> &#x25cf; @subtask.Key</span>
                                            @if (subtask.Assignee != null)
                                            {
                                                <span style="white-space:nowrap;"> &#x25cf; @subtask.Assignee</span>
                                            }
                                                @if (subtask.TimeSpent > 0)
                                                {
                                                    <span> &#x25cf; @subtask.TimeLogged worked </span>
                                                    if (subtask.Resolution == null)
                                                    {
                                                        <span style="color:@color;"> &#x25cf; @subtask.RemainingEstimate left </span>
                                                    }
                                                }
                                        </div>
                                    }
                                }
                            }
                        }
                    }
                </div>
            }
            
        @if (Model.SprintReport.CompletedTasksList != null)
        {
            foreach (var completedTasks in Model.SprintReport.CompletedTasksList)
            {
                if (DateTime.Compare(completedTasks.Tasks.First().ResolutionDate, Model.options.FromDate) < 0)
                {
                    <div style="margin-top:30px">
                        <h4>Completed @completedTasks.CompletedTimeAgo (@completedTasks.Tasks.Count)</h4>
                        @foreach (var task in completedTasks.Tasks)
                        {

                            if (task.Issue.ExistsInTimesheet == true)
                            {
                                bold = "font-weight: bold;";
                            }
                            else
                            {
                                bold = "font-weight: normal;";
                            }
                            <div>
                                <span style="font-family: Segoe UI Symbol; font-size: 10.5pt">&#10004;</span>
                                <a style="text-decoration: none" href="@task.Issue.Link">@task.Issue.Summary</a>
                                <span style="color: #B8B8B8;"> &#x25cf; @task.Issue.Key </span>
                                @if (task.Issue.Assignee != null)
                                {
                                    <span style="white-space:nowrap"> &#x25cf; @task.Issue.Assignee </span>
                                }
                                @if (task.Issue.RemainingEstimateSeconds != 0)
                                {
                                    <span style="white-space:nowrap"> &#x25cf; @task.Issue.RemainingEstimate </span>
                                }    
                            </div>
                        }
                    </div>
                }

            }
        }
    </div>   

</div>
